#' The Capacity of the Weaving Section Between the Main Line and the Connecting Road(pcph)
#'
#' This function decides The capacity of the weaving section between the main line and the connecting road(pcph). It follows <Table 3-2> in KHCM(2013).
#' @param design_speed *Categorical* Choose one from : \code{120}, \code{100}, \code{80} (kph)
#' @param V *Numeric* Total traffic volume (pcph) of the weaving section
#' @param V_w *Numeric* Weaving traffic volume(pcph)
#' @param L *Numeric* Length of the weaving section(m)
#' @param N *Categorical* Total number of lanes in the weaving section. Choose one from : \code{3}, \code{4}, \code{5}
#' @keywords capacity weaving section freeway main line link
#' @export capacity_freeway_weaving The capacity of the weaving section between the main line and the connecting road(pcph)
#' @examples
capacity_freeway_weaving <- function(design_speed = NULL, V = NULL, V_w = NULL, L = NULL, N = NULL){
  if (V_w > 0 & V > 0 & L > 0 & N > 0){
    VR <- V_w/V
    if (design_speed >= 100){
      if (VR == 0.10){
        if (N == 3){
          if (L == 150){cap <- 5100}
          if (L > 150 & L < 300){cap <- 5100 + (100/150) * (L - 150)}
          if (L == 300){cap <- 5200}
          if (L > 300 & L < 450){cap <- 5200 + (200/150) * (L - 300)}
          if (L == 450){cap <- 5400}
          if (L > 450 & L < 600){cap <- 5400 + (100/150) * (L - 450)}
          if (L == 600){cap <- 5500}
          if (L > 600){cap <- 5500 + (100/150) * (L - 600)}
        }
        if (N == 4){
          if (L == 150){cap <- 6900}
          if (L > 150 & L < 300){cap <- 6900 + (200/150) * (L - 150)}
          if (L == 300){cap <- 7100}
          if (L > 300 & L < 450){cap <- 7100 + (200/150) * (L - 300)}
          if (L == 450){cap <- 7300}
          if (L > 450 & L < 600){cap <- 7300 + (200/150) * (L - 450)}
          if (L == 600){cap <- 7500}
          if (L > 600){cap <- 7500 + (200/150) * (L - 600)}
        }
        if (N == 5){
          if (L == 150){cap <- 8600}
          if (L > 150 & L < 300){cap <- 8600 + (300/150) * (L - 150)}
          if (L == 300){cap <- 8900}
          if (L > 300 & L < 450){cap <- 8900 + (300/150) * (L - 300)}
          if (L == 450){cap <- 9200}
          if (L > 450 & L < 600){cap <- 9200 + (100/150) * (L - 450)}
          if (L == 600){cap <- 9300}
          if (L > 600){cap <- 9300 + (100/150) * (L - 600)}
        }
      }
      if (VR == 0.20){
        if (N == 3){
          if (L == 150){cap <- 5000}
          if (L > 150 & L < 300){cap <- 5000 + (100/150) * (L - 150)}
          if (L == 300){cap <- 5100}
          if (L > 300 & L < 450){cap <- 5100 + (200/150) * (L - 300)}
          if (L == 450){cap <- 5300}
          if (L > 450 & L < 600){cap <- 5300 + (100/150) * (L - 450)}
          if (L == 600){cap <- 5400}
          if (L > 600){cap <- 5400 + (100/150) * (L - 600)}
        }
        if (N == 4){
          if (L == 150){cap <- 6800}
          if (L > 150 & L < 300){cap <- 6800 + (200/150) * (L - 150)}
          if (L == 300){cap <- 7000}
          if (L > 300 & L < 450){cap <- 7000 + (200/150) * (L - 300)}
          if (L == 450){cap <- 7200}
          if (L > 450 & L < 600){cap <- 7200 + (200/150) * (L - 450)}
          if (L == 600){cap <- 7400}
          if (L > 600){cap <- 7400 + (200/150) * (L - 600)}
        }
        if (N == 5){
          if (L == 150){cap <- 8400}
          if (L > 150 & L < 300){cap <- 8400 + (300/150) * (L - 150)}
          if (L == 300){cap <- 8700}
          if (L > 300 & L < 450){cap <- 8700 + (300/150) * (L - 300)}
          if (L == 450){cap <- 9000}
          if (L > 450 & L < 600){cap <- 9000 + (200/150) * (L - 450)}
          if (L == 600){cap <- 9200}
          if (L > 600){cap <- 9200 + (200/150) * (L - 600)}
        }
      }
      if (VR == 0.30){
        if (N == 3){
          if (L == 150){cap <- 4900}
          if (L > 150 & L < 300){cap <- 4900 + (100/150) * (L - 150)}
          if (L == 300){cap <- 5000}
          if (L > 300 & L < 450){cap <- 5000 + (200/150) * (L - 300)}
          if (L == 450){cap <- 5200}
          if (L > 450 & L < 600){cap <- 5200 + (100/150) * (L - 450)}
          if (L == 600){cap <- 5300}
          if (L > 600){cap <- 5300 + (100/150) * (L - 600)}
        }
        if (N == 4){
          if (L == 150){cap <- 6600}
          if (L > 150 & L < 300){cap <- 6600 + (200/150) * (L - 150)}
          if (L == 300){cap <- 6800}
          if (L > 300 & L < 450){cap <- 6800 + (200/150) * (L - 300)}
          if (L == 450){cap <- 7100}
          if (L > 450 & L < 600){cap <- 7100 + (200/150) * (L - 450)}
          if (L == 600){cap <- 7300}
          if (L > 600){cap <- 7300 + (200/150) * (L - 600)}
        }
        if (N == 5){
          if (L == 150){cap <- 8200}
          if (L > 150 & L < 300){cap <- 8200 + (400/150) * (L - 150)}
          if (L == 300){cap <- 8600}
          if (L > 300 & L < 450){cap <- 8600 + (300/150) * (L - 300)}
          if (L == 450){cap <- 8900}
          if (L > 450 & L < 600){cap <- 8900 + (200/150) * (L - 450)}
          if (L == 600){cap <- 9100}
          if (L > 600){cap <- 9100 + (200/150) * (L - 600)}
        }
      }
      if (VR == 0.40){
        if (N == 3){
          if (L == 150){cap <- 4800}
          if (L > 150 & L < 300){cap <- 4800 + (100/150) * (L - 150)}
          if (L == 300){cap <- 4900}
          if (L > 300 & L < 450){cap <- 4900 + (200/150) * (L - 300)}
          if (L == 450){cap <- 5100}
          if (L > 450 & L < 600){cap <- 5100 + (100/150) * (L - 450)}
          if (L == 600){cap <- 5200}
          if (L > 600){cap <- 5200 + (100/150) * (L - 600)}
        }
        if (N == 4){
          if (L == 150){cap <- 6500}
          if (L > 150 & L < 300){cap <- 6500 + (200/150) * (L - 150)}
          if (L == 300){cap <- 6700}
          if (L > 300 & L < 450){cap <- 6700 + (300/150) * (L - 300)}
          if (L == 450){cap <- 7000}
          if (L > 450 & L < 600){cap <- 7000 + (200/150) * (L - 450)}
          if (L == 600){cap <- 7200}
          if (L > 600){cap <- 7200 + (200/150) * (L - 600)}
        }
        if (N == 5){
          if (L == 150){cap <- 8100}
          if (L > 150 & L < 300){cap <- 8100 + (300/150) * (L - 150)}
          if (L == 300){cap <- 8400}
          if (L > 300 & L < 450){cap <- 8400 + (400/150) * (L - 300)}
          if (L == 450){cap <- 8800}
          if (L > 450 & L < 600){cap <- 8800 + (400/150) * (L - 450)}
          if (L == 600){cap <- 9000}
          if (L > 600){cap <- 9000 + (200/150) * (L - 600)}
        }
      }
    }
    if (design_speed == 80){
      if (VR == 0.10){
        if (N == 3){
          if (L == 150){cap <- 4600}
          if (L > 150 & L < 300){cap <- 4600 + (200/150) * (L - 150)}
          if (L == 300){cap <- 4800}
          if (L > 300 & L < 450){cap <- 4800 + (100/150) * (L - 300)}
          if (L == 450){cap <- 4900}
          if (L > 450 & L < 600){cap <- 4900 + (100/150) * (L - 450)}
          if (L == 600){cap <- 5000}
          if (L > 600){cap <- 5000 + (100/150) * (L - 600)}
        }
        if (N == 4){
          if (L == 150){cap <- 6200}
          if (L > 150 & L < 300){cap <- 6200 + (200/150) * (L - 150)}
          if (L == 300){cap <- 6400}
          if (L > 300 & L < 450){cap <- 6400 + (200/150) * (L - 300)}
          if (L == 450){cap <- 6600}
          if (L > 450 & L < 600){cap <- 6600 + (100/150) * (L - 450)}
          if (L == 600){cap <- 6700}
          if (L > 600){cap <- 6700 + (100/150) * (L - 600)}
        }
        if (N == 5){
          if (L == 150){cap <- 7800}
          if (L > 150 & L < 300){cap <- 7800 + (200/150) * (L - 150)}
          if (L == 300){cap <- 8000}
          if (L > 300 & L < 450){cap <- 8000 + (300/150) * (L - 300)}
          if (L == 450){cap <- 8300}
          if (L > 450 & L < 600){cap <- 8300 + (100/150) * (L - 450)}
          if (L == 600){cap <- 8400}
          if (L > 600){cap <- 8400 + (100/150) * (L - 600)}
        }
      }
      if (VR == 0.20){
        if (N == 3){
          if (L == 150){cap <- 4500}
          if (L > 150 & L < 300){cap <- 4500 + (200/150) * (L - 150)}
          if (L == 300){cap <- 4700}
          if (L > 300 & L < 450){cap <- 4700 + (100/150) * (L - 300)}
          if (L == 450){cap <- 4800}
          if (L > 450 & L < 600){cap <- 4800 + (100/150) * (L - 450)}
          if (L == 600){cap <- 4900}
          if (L > 600){cap <- 4900 + (100/150) * (L - 600)}
        }
        if (N == 4){
          if (L == 150){cap <- 6100}
          if (L > 150 & L < 300){cap <- 6100 + (200/150) * (L - 150)}
          if (L == 300){cap <- 6300}
          if (L > 300 & L < 450){cap <- 6300 + (200/150) * (L - 300)}
          if (L == 450){cap <- 6500}
          if (L > 450 & L < 600){cap <- 6500 + (100/150) * (L - 450)}
          if (L == 600){cap <- 6600}
          if (L > 600){cap <- 6600 + (100/150) * (L - 600)}
        }
        if (N == 5){
          if (L == 150){cap <- 7700}
          if (L > 150 & L < 300){cap <- 7700 + (200/150) * (L - 150)}
          if (L == 300){cap <- 7900}
          if (L > 300 & L < 450){cap <- 7900 + (300/150) * (L - 300)}
          if (L == 450){cap <- 8200}
          if (L > 450 & L < 600){cap <- 8200 + (100/150) * (L - 450)}
          if (L == 600){cap <- 8300}
          if (L > 600){cap <- 8300 + (100/150) * (L - 600)}
        }
      }
      if (VR == 0.30){
        if (N == 3){
          if (L == 150){cap <- 4400}
          if (L > 150 & L < 300){cap <- 4400 + (200/150) * (L - 150)}
          if (L == 300){cap <- 4600}
          if (L > 300 & L < 450){cap <- 4600 + (100/150) * (L - 300)}
          if (L == 450){cap <- 4700}
          if (L > 450 & L < 600){cap <- 4700 + (100/150) * (L - 450)}
          if (L == 600){cap <- 4800}
          if (L > 600){cap <- 4800 + (100/150) * (L - 600)}
        }
        if (N == 4){
          if (L == 150){cap <- 5900}
          if (L > 150 & L < 300){cap <- 5900 + (300/150) * (L - 150)}
          if (L == 300){cap <- 6200}
          if (L > 300 & L < 450){cap <- 6200 + (200/150) * (L - 300)}
          if (L == 450){cap <- 6400}
          if (L > 450 & L < 600){cap <- 6400 + (100/150) * (L - 450)}
          if (L == 600){cap <- 6500}
          if (L > 600){cap <- 6500 + (100/150) * (L - 600)}
        }
        if (N == 5){
          if (L == 150){cap <- 7600}
          if (L > 150 & L < 300){cap <- 7600 + (200/150) * (L - 150)}
          if (L == 300){cap <- 7800}
          if (L > 300 & L < 450){cap <- 7800 + (300/150) * (L - 300)}
          if (L == 450){cap <- 8100}
          if (L > 450 & L < 600){cap <- 8100 + (100/150) * (L - 450)}
          if (L == 600){cap <- 8200}
          if (L > 600){cap <- 8200 + (100/150) * (L - 600)}
        }
      }
      if (VR == 0.40){
        if (N == 3){
          if (L == 150){cap <- 4300}
          if (L > 150 & L < 300){cap <- 4300 + (200/150) * (L - 150)}
          if (L == 300){cap <- 4500}
          if (L > 300 & L < 450){cap <- 4500 + (100/150) * (L - 300)}
          if (L == 450){cap <- 4600}
          if (L > 450 & L < 600){cap <- 4600 + (100/150) * (L - 450)}
          if (L == 600){cap <- 4700}
          if (L > 600){cap <- 4700 + (100/150) * (L - 600)}
        }
        if (N == 4){
          if (L == 150){cap <- 5700}
          if (L > 150 & L < 300){cap <- 5700 + (400/150) * (L - 150)}
          if (L == 300){cap <- 6100}
          if (L > 300 & L < 450){cap <- 6100 + (200/150) * (L - 300)}
          if (L == 450){cap <- 6300}
          if (L > 450 & L < 600){cap <- 6300 + (100/150) * (L - 450)}
          if (L == 600){cap <- 6400}
          if (L > 600){cap <- 6400 + (100/150) * (L - 600)}
        }
        if (N == 5){
          if (L == 150){cap <- 7300}
          if (L > 150 & L < 300){cap <- 7300 + (300/150) * (L - 150)}
          if (L == 300){cap <- 7600}
          if (L > 300 & L < 450){cap <- 7600 + (400/150) * (L - 300)}
          if (L == 450){cap <- 8000}
          if (L > 450 & L < 600){cap <- 8000 + (100/150) * (L - 450)}
          if (L == 600){cap <- 8100}
          if (L > 600){cap <- 8100 + (100/150) * (L - 600)}
        }
      }
    }
    cap
  }
}
capacity_freeway_weaving(design_speed = 120, V = 80, V_w = 74, L = 200, N = 3)
